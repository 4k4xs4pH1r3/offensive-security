# Check if the system is vulnerable
if ($env:PROCESSOR_ARCHITECTURE -eq "AMD64") {
  $RegistryPath = "HKLM:\HARDWARE\DESCRIPTION\System\CentralProcessor\0"
  $VendorID = (Get-ItemProperty -Path $RegistryPath).VendorIdentifier
  if ($VendorID -match "GenuineIntel") {
    Write-Host "This system is potentially vulnerable to CVE-2022-0001."

    # Apply registry mitigations using New-ItemProperty
    New-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" -Name FeatureSettingsOverride -PropertyType DWORD -Value 0x00800000 -Force
    New-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" -Name FeatureSettingsOverrideMask -PropertyType DWORD -Value 0x00000003 -Force

    Write-Host "Registry mitigations applied. Reboot the server to complete the process."
  } else {
    Write-Host "This system is not vulnerable to CVE-2022-0001."
  }
} else {
  Write-Host "This script is only applicable to 64-bit systems."
}

Get-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management"

hostname

ipconfig
